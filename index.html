<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>吨袋缠绕膜成本计算器</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #27ae60;
            --light: #f8f9fa;
            --dark: #34495e;
            --border: #dee2e6;
            --shadow: rgba(0,0,0,0.1);
            --teal: #1abc9c;
            --purple: #9b59b6;
            --orange: #e67e22;
            --film-blue: #3498db;
            --bag-green: #2ecc71;
            --labor-color: #f39c12;
            --bundle-color: #9b59b6;
            --roi-color: #16a085;
            --finance-color: #8e44ad;
            --break-even-color: #3498db;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Noto Sans SC', 'Segoe UI', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf9 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: -50px;
            left: -50px;
            width: 200px;
            height: 200px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }
        
        header::after {
            content: '';
            position: absolute;
            bottom: -30px;
            right: -30px;
            width: 150px;
            height: 150px;
            background: rgba(255,255,255,0.08);
            border-radius: 50%;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.92;
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
            align-items: start;
        }
        
        @media (max-width: 992px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            padding: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            height: auto;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
            font-size: 1.7rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card h3 {
            color: var(--secondary);
            margin: 20px 0 15px;
            font-size: 1.3rem;
            position: relative;
            padding-left: 15px;
        }
        
        .card h3::before {
            content: '';
            position: absolute;
            left: 0;
            top: 7px;
            width: 6px;
            height: 22px;
            background: var(--secondary);
            border-radius: 3px;
        }
        
        input, select {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            font-size: 1rem;
            background: #fff;
            transition: all 0.2s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.2);
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            min-width: 160px;
            flex: 1;
        }
        
        button i {
            font-size: 1.1rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary), #217dbb);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2980b9, #1a6ca3);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--teal), #16a085);
            color: white;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #1abc9c, #16a085);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn-accent {
            background: linear-gradient(135deg, var(--accent), #c0392b);
            color: white;
        }
        
        .btn-accent:hover {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn-save {
            background: linear-gradient(135deg, var(--purple), #8e44ad);
            color: white;
        }
        
        .btn-save:hover {
            background: linear-gradient(135deg, #8e44ad, #7d3c98);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .chart-container {
            margin-top: 25px;
            height: 280px;
            position: relative;
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .summary-card {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .summary-item {
            background: white;
            border-radius: 10px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.06);
            border: 1px solid rgba(0,0,0,0.03);
            transition: transform 0.3s ease;
        }
        
        .summary-item:hover {
            transform: translateY(-3px);
        }
        
        .summary-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 10px 0;
            letter-spacing: -0.5px;
        }
        
        .summary-label {
            font-size: 0.95rem;
            color: #4a5568;
            font-weight: 500;
        }
        
        .profit {
            color: var(--success);
        }
        
        .loss {
            color: var(--accent);
        }
        
        .input-label {
            font-weight: bold;
            margin-bottom: 6px;
            display: block;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .input-with-unit {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .input-with-unit input {
            flex: 1;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            font-size: 1.1rem;
        }
        
        .input-unit {
            background: #e9ecef;
            padding: 0 12px;
            height: 100%;
            display: flex;
            align-items: center;
            border: 1px solid #ced4da;
            border-left: none;
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
            min-width: 80px;
            font-size: 0.85rem;
        }
        
        .param-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .param-item {
            display: flex;
            flex-direction: column;
            margin-bottom: 12px;
        }
        
        .bag-types-container, .film-types-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            background: white;
        }
        
        .bag-type, .film-type {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            border-radius: 8px;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .bag-type.selected, .film-type.selected {
            background: #e3f2fd;
            border: 2px solid var(--secondary);
        }
        
        .bag-type:last-child, .film-type:last-child {
            margin-bottom: 0;
        }
        
        .bag-type:hover, .film-type:hover {
            background: #e9f7ff;
        }
        
        .bag-spec, .film-spec {
            flex: 1;
            font-weight: 600;
            color: var(--primary);
            font-size: 0.95rem;
        }
        
        .bag-price, .film-price {
            font-weight: bold;
            min-width: 100px;
            text-align: right;
            color: var(--success);
            font-size: 0.95rem;
        }
        
        @media (max-width: 768px) {
            .param-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .cost-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
        }
        
        .cost-detail-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 4px solid var(--secondary);
            position: relative;
            transition: all 0.3s ease;
        }
        
        .cost-detail-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }
        
        .cost-detail-film {
            border-left-color: var(--film-blue);
        }
        
        .cost-detail-bag {
            border-left-color: var(--bag-green);
        }
        
        .cost-detail-labor {
            border-left-color: var(--labor-color);
        }
        
        .cost-detail-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
            padding-right: 40px;
        }
        
        .cost-detail-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary);
            text-align: center;
            margin: 8px 0;
        }
        
        .cost-detail-explanation {
            font-size: 0.85rem;
            color: #7f8c8d;
            text-align: center;
        }
        
        .profit-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .profit-item {
            background: white;
            border-radius: 8px;
            padding: 18px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            text-align: center;
            border-top: 4px solid var(--teal);
            transition: all 0.3s ease;
        }
        
        .profit-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.08);
        }
        
        .profit-value {
            font-size: 1.6rem;
            font-weight: bold;
            margin: 8px 0;
        }
        
        .profit-label {
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .currency-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            background: var(--secondary);
            color: white;
            margin-left: 5px;
        }
        
        footer {
            text-align: center;
            margin-top: 35px;
            padding: 20px;
            color: #718096;
            font-size: 0.85rem;
        }
        
        .calculation-info {
            background: #e8f4fd;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            font-size: 0.85rem;
            border-left: 4px solid var(--secondary);
        }
        
        .calculation-info p {
            margin: 4px 0;
        }
        
        .formula {
            font-family: monospace;
            background: rgba(255,255,255,0.7);
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
            margin: 4px 0;
            border: 1px dashed var(--secondary);
            font-size: 0.85rem;
        }
        
        .save-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            animation: fadeInOut 3s ease;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        
        .calculation-step {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            border-left: 4px solid var(--orange);
        }
        
        .calculation-step h4 {
            margin: 0 0 8px 0;
            color: var(--orange);
            font-size: 1.1rem;
        }
        
        .formula-highlight {
            background-color: #e1f5fe;
            padding: 8px;
            border-radius: 8px;
            margin: 8px 0;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .toggle-container {
            position: absolute;
            top: 12px;
            right: 12px;
        }
        
        .toggle {
            position: relative;
            display: inline-block;
            width: 45px;
            height: 22px;
        }
        
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 22px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--success);
        }
        
        input:checked + .slider:before {
            transform: translateX(23px);
        }
        
        .total-cost-display {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            border-radius: 10px;
            padding: 18px;
            margin: 15px 0;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.12);
        }
        
        .bag-total-cost {
            background: linear-gradient(135deg, var(--bag-green), #27ae60);
        }
        
        .film-total-cost {
            background: linear-gradient(135deg, var(--film-blue), #0d47a1);
        }
        
        .total-cost-label {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }
        
        .total-cost-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 8px 0;
        }
        
        .total-cost-unit {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .cost-item-disabled {
            opacity: 0.6;
            background-color: #f8f9fa;
        }
        
        .cost-item-disabled .cost-detail-value {
            color: #95a5a6;
        }
        
        .film-costs-section {
            border: 2px solid var(--film-blue);
            border-radius: 12px;
            padding: 18px;
            margin-top: 25px;
            background: rgba(225, 245, 254, 0.15);
        }
        
        .bag-costs-section {
            border: 2px solid var(--bag-green);
            border-radius: 12px;
            padding: 18px;
            margin-top: 25px;
            background: rgba(232, 245, 233, 0.15);
        }
        
        .capital-analysis {
            background: linear-gradient(135deg, #f0f7ff, #e1f0ff);
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
        }
        
        .capital-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .capital-item {
            background: white;
            border-radius: 10px;
            padding: 18px;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            border-top: 4px solid var(--purple);
            transition: all 0.3s ease;
        }
        
        .capital-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.08);
        }
        
        .capital-value {
            font-size: 1.6rem;
            font-weight: bold;
            margin: 8px 0;
        }
        
        .capital-label {
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .capital-unit {
            font-size: 0.85rem;
            color: #7f8c8d;
        }
        
        .capital-section-title {
            font-size: 1.2rem;
            color: var(--dark);
            margin: 20px 0 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .capital-section-title i {
            font-size: 1.1rem;
            color: var(--purple);
        }
        
        .cost-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .cost-detail-title-text {
            font-weight: bold;
            color: var(--primary);
            font-size: 1rem;
            flex: 1;
        }
        
        .analysis-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        @media (max-width: 992px) {
            .analysis-sections {
                grid-template-columns: 1fr;
            }
        }
        
        .analysis-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .full-width-item {
            grid-column: 1 / -1;
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            border-top: 4px solid var(--purple);
        }
        
        .full-width-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .cost-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .cost-summary-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            text-align: center;
            border-top: 4px solid var(--teal);
        }
        
        .cost-summary-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 8px 0;
        }
        
        .cost-summary-label {
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .gross-margin-analysis {
            margin-top: 30px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .gross-margin-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .gross-margin-item {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            border-top: 4px solid var(--teal);
        }
        
        .gross-margin-value {
            font-size: 1.6rem;
            font-weight: bold;
            margin: 8px 0;
        }
        
        .gross-margin-label {
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .capital-occupation-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .capital-occupation-input {
            display: flex;
            flex-direction: column;
        }
        
        .bundle-analysis {
            margin-top: 30px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-top: 4px solid var(--bundle-color);
        }
        
        .bundle-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .bundle-item {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            border-top: 4px solid var(--bundle-color);
        }
        
        .bundle-value {
            font-size: 1.6rem;
            font-weight: bold;
            margin: 8px 0;
            color: var(--bundle-color);
        }
        
        .bundle-label {
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .bundle-calculation {
            background: #f0f7ff;
            border-left: 4px solid var(--bundle-color);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .sensitivity-analysis {
            margin-top: 30px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-top: 4px solid var(--orange);
        }
        
        .sensitivity-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .sensitivity-chart-container {
            height: 250px;
            margin-top: 20px;
        }
        
        .currency-switch {
            display: flex;
            align-items: center;
            background: #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .currency-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .currency-option.active {
            background: var(--secondary);
            color: white;
            font-weight: bold;
        }
        
        .currency-option:not(.active):hover {
            background: #d0e0f0;
        }
        
        .factory-price-container {
            display: grid;
            grid-template-columns: 70% 30%;
            gap: 8px;
        }
        
        #factory-price, #film-factory-price {
            width: 100%;
        }
        
        #factory-price-currency, #film-factory-price-currency {
            width: 100%;
            font-size: 0.85rem;
        }
        
        .bundle-input-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .bundle-input-container input {
            flex: 1;
            font-size: 1.05rem;
            text-align: center;
        }
        
        .bag-radio {
            display: none !important;
        }
        
        .formula-highlight {
            background-color: #e1f5fe;
            padding: 8px;
            border-radius: 8px;
            margin: 8px 0;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .bag-spec {
            padding-left: 0;
        }
        
        .card-title-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-title-icon {
            font-size: 1.8rem;
            color: var(--secondary);
        }
        
        .film-highlight {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        
        .film-highlight h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .film-highlight .formula-highlight {
            background-color: #bbdefb;
            padding: 8px;
            border-radius: 6px;
            font-weight: 600;
        }
        
        .roi-analysis {
            margin-top: 30px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-top: 4px solid var(--roi-color);
        }
        
        .roi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .roi-item {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            border-top: 4px solid var(--roi-color);
            text-align: center;
        }
        
        .roi-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 8px 0;
            color: var(--roi-color);
        }
        
        .roi-label {
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .roi-calculation {
            background: #f0f7ff;
            border-left: 4px solid var(--roi-color);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        /* 专业财务分析样式 */
        .financial-analysis {
            margin-top: 30px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-top: 4px solid var(--finance-color);
        }
        
        .finance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .finance-item {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            border-top: 4px solid var(--finance-color);
            text-align: center;
        }
        
        .finance-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 8px 0;
            color: var(--finance-color);
        }
        
        .finance-label {
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .finance-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .finance-table th {
            background-color: #f0f7ff;
            padding: 10px;
            text-align: left;
            font-weight: 600;
        }
        
        .finance-table td {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .finance-table tr:last-child td {
            border-bottom: none;
        }
        
        .finance-table .highlight {
            background-color: #e1f5fe;
            font-weight: 600;
        }
        
        .finance-chart-container {
            height: 250px;
            margin-top: 20px;
        }
        
        .calculation-table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .calculation-table th {
            background-color: #f8f9fa;
            padding: 10px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }
        
        .calculation-table td {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .calculation-table .formula-cell {
            font-family: monospace;
            background-color: #e9f7ff;
        }
        
        .calculation-table .result-cell {
            font-weight: 600;
            color: var(--secondary);
        }
        
        .finance-explanation {
            font-size: 0.85rem;
            color: #7f8c8d;
            text-align: center;
            margin-top: 8px;
        }
        
        .gross-profit-analysis {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .gross-profit-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .gross-profit-item {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            border-top: 4px solid var(--teal);
            text-align: center;
            margin-bottom: 15px;
        }
        
        .gross-profit-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 8px 0;
            color: var(--success);
        }
        
        .gross-profit-label {
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .gross-profit-explanation {
            font-size: 0.85rem;
            color: #7f8c8d;
            text-align: center;
            margin-top: 8px;
        }
        
        .break-even-analysis {
            margin-top: 30px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-top: 4px solid var(--break-even-color);
        }
        
        .break-even-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .break-even-item {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            border-top: 4px solid var(--break-even-color);
            text-align: center;
        }
        
        .break-even-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 8px 0;
            color: var(--break-even-color);
        }
        
        .break-even-label {
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .break-even-explanation {
            font-size: 0.85rem;
            color: #7f8c8d;
            text-align: center;
            margin-top: 8px;
        }
        
        .roi-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .roi-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .calculation-explanation {
            background: #f0f7ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-size: 0.85rem;
        }
        
        .calculation-formula {
            font-family: monospace;
            background: #e1f5fe;
            padding: 5px;
            border-radius: 4px;
            margin: 5px 0;
        }
        
        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn-group button {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .profit-analysis {
                grid-template-columns: 1fr;
            }
            
            .cost-details-grid {
                grid-template-columns: 1fr;
            }
            
            .cost-summary {
                grid-template-columns: 1fr;
            }
            
            .gross-margin-grid {
                grid-template-columns: 1fr;
            }
            
            .capital-occupation-inputs {
                grid-template-columns: 1fr;
            }
            
            .bundle-grid {
                grid-template-columns: 1fr;
            }
            
            .sensitivity-grid {
                grid-template-columns: 1fr;
            }
            
            .factory-price-container {
                grid-template-columns: 1fr;
            }
            
            .card h2 {
                height: auto;
                flex-direction: column;
                align-items: flex-start;
            }
            
            .finance-grid {
                grid-template-columns: 1fr;
            }
            
            .gross-profit-analysis {
                grid-template-columns: 1fr;
            }
            
            .roi-layout {
                grid-template-columns: 1fr;
            }
            
            .break-even-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-calculator"></i> 吨袋缠绕膜成本计算器</h1>
            <p class="subtitle">综合成本计算 | 资金回报率分析 | 盈亏平衡分析</p>
        </header>
        
        <div class="save-notification" id="saveNotification">
            <i class="fas fa-check-circle"></i> 配置已保存成功！
        </div>
        
        <div class="grid">
            <!-- 输入区 -->
            <div class="card">
                <div class="card-title-container">
                    <h2><i class="fas fa-edit card-title-icon"></i> 成本参数输入</h2>
                </div>
                
                <div class="param-grid">
                    <div class="param-item">
                        <label for="exchange-rate">人民币兑加币汇率</label>
                        <div class="input-with-unit">
                            <input type="number" id="exchange-rate" value="0.186" step="0.001">
                            <div class="input-unit">CNY/CAD</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="usd-to-cad">美元兑加币汇率</label>
                        <div class="input-with-unit">
                            <input type="number" id="usd-to-cad" value="1.35" step="0.001">
                            <div class="input-unit">CAD/USD</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="shipping-cost">海运费 + 报关费</label>
                        <div class="input-with-unit">
                            <input type="number" id="shipping-cost" value="5000">
                            <div class="input-unit">USD</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="pallet-storage">卡板仓储费</label>
                        <div class="input-with-unit">
                            <input type="number" id="pallet-storage" value="16">
                            <div class="input-unit">USD/月</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="pallet-handling">进仓出仓操作费</label>
                        <div class="input-with-unit">
                            <input type="number" id="pallet-handling" value="25">
                            <div class="input-unit">USD/卡板</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="storage-time">仓储时间</label>
                        <div class="input-with-unit">
                            <input type="number" id="storage-time" value="3">
                            <div class="input-unit">月</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="interest-rate">资金成本年利率</label>
                        <div class="input-with-unit">
                            <input type="number" id="interest-rate" value="5" step="0.1">
                            <div class="input-unit">%</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="capital-time">资金占用时间/库存周转时间</label>
                        <div class="input-with-unit">
                            <input type="number" id="capital-time" value="4">
                            <div class="input-unit">月</div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3><i class="fas fa-user-tie"></i> 人工配置</h3>
                    
                    <div class="param-grid">
                        <div class="param-item">
                            <label for="labor-rate">人工价格</label>
                            <div class="input-with-unit">
                                <input type="number" id="labor-rate" value="30">
                                <div class="input-unit">$/小时</div>
                            </div>
                        </div>
                        
                        <div class="param-item">
                            <label for="labor-count">雇佣人数</label>
                            <div class="input-with-unit">
                                <input type="number" id="labor-count" value="1">
                                <div class="input-unit">人</div>
                            </div>
                        </div>
                        
                        <div class="param-item">
                            <label for="daily-hours">日工作时长</label>
                            <div class="input-with-unit">
                                <input type="number" id="daily-hours" value="8">
                                <div class="input-unit">小时/天</div>
                            </div>
                        </div>
                        
                        <div class="param-item">
                            <label for="work-days">月工作天数</label>
                            <div class="input-with-unit">
                                <input type="number" id="work-days" value="22">
                                <div class="input-unit">天/月</div>
                            </div>
                        </div>
                        
                        <div class="param-item">
                            <label for="monthly-bags">月销售吨袋预估</label>
                            <div class="input-with-unit">
                                <input type="number" id="monthly-bags" value="8000">
                                <div class="input-unit">袋/月</div>
                            </div>
                        </div>
                        
                        <div class="param-item">
                            <label for="monthly-rolls">月销售缠绕膜预估</label>
                            <div class="input-with-unit">
                                <input type="number" id="monthly-rolls" value="5000">
                                <div class="input-unit">卷/月</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bag-costs-section">
                    <h3><i class="fas fa-pallet"></i> 吨袋规格与采购成本</h3>
                    
                    <div class="bag-highlight">
                        <div class="bag-info">
                            <h3><span id="selected-bag-spec">38×38×57 SKT/DS</span></h3>
                            <div class="formula-highlight">
                                销售价 = <span id="selected-bag-price">9.14</span> CAD/袋
                            </div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="tariff-bag">吨袋关税税率</label>
                        <div class="input-with-unit">
                            <input type="number" id="tariff-bag" value="18" step="0.1">
                            <div class="input-unit">%</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="bag-under-declaration">吨袋低申报系数</label>
                        <div class="input-with-unit">
                            <input type="number" id="bag-under-declaration" value="1.0" step="0.01" min="0.01" max="1.0">
                            <div class="input-unit">系数</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="factory-price">工厂价格</label>
                        <div class="input-with-unit">
                            <input type="number" id="factory-price" value="2.636">
                            <div class="input-unit">USD/袋</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="container-size">集装箱容量</label>
                        <div class="input-with-unit">
                            <input type="number" id="container-size" value="8000">
                            <div class="input-unit">袋</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="bags-per-pallet">每卡板袋数</label>
                        <div class="input-with-unit">
                            <input type="number" id="bags-per-pallet" value="200">
                            <div class="input-unit">袋</div>
                        </div>
                    </div>
                    
                    <div class="bag-types-container">
                        <div class="bag-type" data-type="1" data-price="10.08">
                            <div class="bag-spec">38×38×68" 吨袋</div>
                            <div class="input-with-unit">
                                <input type="number" id="bag-type1" class="bag-price-input" value="10.08">
                                <div class="input-unit">CAD/袋</div>
                            </div>
                        </div>
                        <div class="bag-type selected" data-type="2" data-price="9.14">
                            <div class="bag-spec">38×38×57 SKT/DS</div>
                            <div class="input-with-unit">
                                <input type="number" id="bag-type2" class="bag-price-input" value="9.14">
                                <div class="input-unit">CAD/袋</div>
                            </div>
                        </div>
                        <div class="bag-type" data-type="3" data-price="10.34">
                            <div class="bag-spec">42×42×66" 吨袋</div>
                            <div class="input-with-unit">
                                <input type="number" id="bag-type3" class="bag-price-input" value="10.34">
                                <div class="input-unit">CAD/袋</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="film-costs-section">
                    <h3><i class="fas fa-film"></i> 缠绕膜规格与采购成本</h3>
                    
                    <div class="film-highlight">
                        <div class="film-info">
                            <h3><i class="fas fa-info-circle"></i> 当前规格: <span id="selected-film-spec">70ga</span></h3>
                            <div class="formula-highlight">
                                销售价 = <span id="selected-film-price">13.00</span> CAD/卷
                            </div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="tariff-film">缠绕膜关税税率</label>
                        <div class="input-with-unit">
                            <input type="number" id="tariff-film" value="15" step="0.1">
                            <div class="input-unit">%</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="film-under-declaration">缠绕膜低申报系数</label>
                        <div class="input-with-unit">
                            <input type="number" id="film-under-declaration" value="1.0" step="0.01" min="0.01" max="1.0">
                            <div class="input-unit">系数</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="film-usage">每吨袋缠绕膜用量</label>
                        <div class="input-with-unit">
                            <input type="number" id="film-usage" value="30" step="0.1">
                            <div class="input-unit">米/袋</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="film-length">缠绕膜长度</label>
                        <div class="input-with-unit">
                            <input type="number" id="film-length" value="450">
                            <div class="input-unit">米/卷</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="film-factory-price">工厂价格</label>
                        <div class="input-with-unit">
                            <input type="number" id="film-factory-price" value="3.3">
                            <div class="input-unit">USD/卷</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="rolls-per-container">每集装箱卷数</label>
                        <div class="input-with-unit">
                            <input type="number" id="rolls-per-container" value="3200">
                            <div class="input-unit">卷</div>
                        </div>
                    </div>
                    
                    <div class="param-item">
                        <label for="rolls-per-pallet">每卡板卷数</label>
                        <div class="input-with-unit">
                            <input type="number" id="rolls-per-pallet" value="96">
                            <div class="input-unit">卷</div>
                        </div>
                    </div>
                    
                    <div class="film-types-container">
                        <div class="film-type selected" data-type="70ga" data-price="13">
                            <div class="film-spec">70ga 缠绕膜</div>
                            <div class="input-with-unit">
                                <input type="number" id="film-type1" class="film-price-input" value="13">
                                <div class="input-unit">CAD/卷</div>
                            </div>
                        </div>
                        <div class="film-type" data-type="80ga" data-price="13">
                            <div class="film-spec">80ga 缠绕膜</div>
                            <div class="input-with-unit">
                                <input type="number" id="film-type2" class="film-price-input" value="13">
                                <div class="input-unit">CAD/卷</div>
                            </div>
                        </div>
                        <div class="film-type" data-type="90ga" data-price="13">
                            <div class="film-spec">90ga 缠绕膜</div>
                            <div class="input-with-unit">
                                <input type="number" id="film-type3" class="film-price-input" value="13">
                                <div class="input-unit">CAD/卷</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn-primary" onclick="calculate()">
                        <i class="fas fa-calculator"></i> 计算利润
                    </button>
                    <button class="btn-secondary" onclick="resetForm()">
                        <i class="fas fa-sync-alt"></i> 重置表单
                    </button>
                    <button class="btn-save" onclick="saveConfig()">
                        <i class="fas fa-save"></i> 保存配置
                    </button>
                </div>
            </div>
            
            <!-- 成本与盈利分析 -->
            <div class="card">
                <div class="card-title-container">
                    <h2><i class="fas fa-chart-line card-title-icon"></i> 成本与盈利分析</h2>
                </div>
                <div id="results">
                    <div class="analysis-sections">
                        <!-- 吨袋成本与盈利分析 -->
                        <div class="analysis-section">
                            <h3><i class="fas fa-pallet"></i> 吨袋成本与盈利分析</h3>
                            
                            <div class="cost-summary">
                                <div class="cost-summary-item">
                                    <div class="cost-summary-label">单袋总成本</div>
                                    <div class="cost-summary-value" id="bag-total-cost">$6.44</div>
                                    <div class="cost-summary-label">CAD/袋</div>
                                </div>
                                <div class="cost-summary-item">
                                    <div class="cost-summary-label">销售价</div>
                                    <div class="cost-summary-value" id="bag-sale-price">$9.14</div>
                                    <div class="cost-summary-label">CAD/袋</div>
                                </div>
                                <div class="cost-summary-item">
                                    <div class="cost-summary-label">单袋利润</div>
                                    <div class="cost-summary-value profit" id="bag-profit-per">$2.70</div>
                                    <div class="cost-summary-label">CAD/袋</div>
                                </div>
                                <div class="cost-summary-item">
                                    <div class="cost-summary-label">毛利率</div>
                                    <div class="cost-summary-value profit" id="bag-gross-margin">29.5%</div>
                                </div>
                            </div>
                            
                            <div class="cost-details-grid">
                                <div class="cost-detail-item cost-detail-bag">
                                    <div class="cost-detail-header">
                                        <div class="cost-detail-title-text">采购成本 <span class="unit">(CAD/袋)</span></div>
                                        <label class="toggle">
                                            <input type="checkbox" id="toggle-bag-purchase" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="cost-detail-value" id="bag-purchase-cost">$3.56</div>
                                    <div class="cost-detail-explanation" id="bag-purchase-cost-explanation">工厂价格: $2.636 × 1.35 = $3.56</div>
                                </div>
                                
                                <div class="cost-detail-item cost-detail-bag">
                                    <div class="cost-detail-header">
                                        <div class="cost-detail-title-text">海运费 <span class="unit">(CAD/袋)</span></div>
                                        <label class="toggle">
                                            <input type="checkbox" id="toggle-bag-shipping" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="cost-detail-value" id="bag-shipping-cost">$0.84</div>
                                    <div class="cost-detail-explanation" id="bag-shipping-cost-explanation">$5000 × 1.35 ÷ 8000 = $0.8438</div>
                                </div>
                                
                                <div class="cost-detail-item cost-detail-bag">
                                    <div class="cost-detail-header">
                                        <div class="cost-detail-title-text">关税 <span class="unit">(CAD/袋)</span></div>
                                        <label class="toggle">
                                            <input type="checkbox" id="toggle-bag-tariff" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="cost-detail-value" id="bag-tariff-cost">$0.79</div>
                                    <div class="cost-detail-explanation" id="bag-tariff-cost-explanation">(3.56 × 1 + 0.84) × 18.0% = $0.7924</div>
                                </div>
                                
                                <div class="cost-detail-item cost-detail-bag">
                                    <div class="cost-detail-header">
                                        <div class="cost-detail-title-text">仓储与操作 <span class="unit">(CAD/袋)</span></div>
                                        <label class="toggle">
                                            <input type="checkbox" id="toggle-bag-storage" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="cost-detail-value" id="bag-storage-cost">$0.49</div>
                                    <div class="cost-detail-explanation" id="bag-storage-cost-explanation">($25 + $16 × 3) × 1.35 ÷ 200 = $0.4928</div>
                                </div>
                                
                                <div class="cost-detail-item cost-detail-bag">
                                    <div class="cost-detail-header">
                                        <div class="cost-detail-title-text">资金成本 <span class="unit">(CAD/袋)</span></div>
                                        <label class="toggle">
                                            <input type="checkbox" id="toggle-bag-capital" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="cost-detail-value" id="bag-capital-cost">$0.09</div>
                                    <div class="cost-detail-explanation" id="bag-capital-cost-explanation">(5.69) × 5.0% × 4/12 = $0.0948</div>
                                </div>
                                
                                <div class="cost-detail-item cost-detail-labor">
                                    <div class="cost-detail-header">
                                        <div class="cost-detail-title-text">人工成本 <span class="unit">(CAD/袋)</span></div>
                                        <label class="toggle">
                                            <input type="checkbox" id="toggle-bag-labor" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="cost-detail-value" id="bag-labor-cost">$0.66</div>
                                    <div class="cost-detail-explanation" id="bag-labor-cost-explanation">($30 × 8 × 22 × 1) ÷ 8000 = $0.6600</div>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <canvas id="bagCostChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- 缠绕膜成本与盈利分析 -->
                        <div class="analysis-section">
                            <h3><i class="fas fa-film"></i> 缠绕膜成本与盈利分析</h3>
                            
                            <div class="cost-summary">
                                <div class="cost-summary-item">
                                    <div class="cost-summary-label">单卷总成本</div>
                                    <div class="cost-summary-value" id="film-total-cost">$9.77</div>
                                    <div class="cost-summary-label">CAD/卷</div>
                                </div>
                                <div class="cost-summary-item">
                                    <div class="cost-summary-label">销售价</div>
                                    <div class="cost-summary-value" id="film-sale-price">$13.00</div>
                                    <div class="cost-summary-label">CAD/卷</div>
                                </div>
                                <div class="cost-summary-item">
                                    <div class="cost-summary-label">单卷利润</div>
                                    <div class="cost-summary-value profit" id="film-profit-per">$3.23</div>
                                    <div class="cost-summary-label">CAD/卷</div>
                                </div>
                                <div class="cost-summary-item">
                                    <div class="cost-summary-label">毛利率</div>
                                    <div class="cost-summary-value profit" id="film-gross-margin">24.8%</div>
                                </div>
                            </div>
                            
                            <div class="cost-details-grid">
                                <div class="cost-detail-item cost-detail-film">
                                    <div class="cost-detail-header">
                                        <div class="cost-detail-title-text">采购成本 <span class="unit">(CAD/卷)</span></div>
                                        <label class="toggle">
                                            <input type="checkbox" id="toggle-film-purchase" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="cost-detail-value" id="film-purchase-cost">$4.46</div>
                                    <div class="cost-detail-explanation" id="film-purchase-cost-explanation">工厂价格: $3.3 × 1.35 = $4.455</div>
                                </div>
                                
                                <div class="cost-detail-item cost-detail-film">
                                    <div class="cost-detail-header">
                                        <div class="cost-detail-title-text">海运费 <span class="unit">(CAD/卷)</span></div>
                                        <label class="toggle">
                                            <input type="checkbox" id="toggle-film-shipping" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="cost-detail-value" id="film-shipping-cost">$2.11</div>
                                    <div class="cost-detail-explanation" id="film-shipping-cost-explanation">$5000 × 1.35 ÷ 3200 = $2.1094</div>
                                </div>
                                
                                <div class="cost-detail-item cost-detail-film">
                                    <div class="cost-detail-header">
                                        <div class="cost-detail-title-text">关税 <span class="unit">(CAD/卷)</span></div>
                                        <label class="toggle">
                                            <input type="checkbox" id="toggle-film-tariff" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="cost-detail-value" id="film-tariff-cost">$0.98</div>
                                    <div class="cost-detail-explanation" id="film-tariff-cost-explanation">(4.46 × 1 + 2.11) × 15.0% = $0.9847</div>
                                </div>
                                
                                <div class="cost-detail-item cost-detail-film">
                                    <div class="cost-detail-header">
                                        <div class="cost-detail-title-text">仓储与操作 <span class="unit">(CAD/卷)</span></div>
                                        <label class="toggle">
                                            <input type="checkbox" id="toggle-film-storage" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="cost-detail-value" id="film-storage-cost">$1.03</div>
                                    <div class="cost-detail-explanation" id="film-storage-cost-explanation">($25 + $16 × 3) × 1.35 ÷ 96 = $1.0266</div>
                                </div>
                                
                                <div class="cost-detail-item cost-detail-film">
                                    <div class="cost-detail-header">
                                        <div class="cost-detail-title-text">资金成本 <span class="unit">(CAD/卷)</span></div>
                                        <label class="toggle">
                                            <input type="checkbox" id="toggle-film-capital" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="cost-detail-value" id="film-capital-cost">$0.14</div>
                                    <div class="cost-detail-explanation" id="film-capital-cost-explanation">(8.58) × 5.0% × 4/12 = $0.1429</div>
                                </div>
                                
                                <div class="cost-detail-item cost-detail-labor">
                                    <div class="cost-detail-header">
                                        <div class="cost-detail-title-text">人工成本 <span class="unit">(CAD/卷)</span></div>
                                        <label class="toggle">
                                            <input type="checkbox" id="toggle-film-labor" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="cost-detail-value" id="film-labor-cost">$1.06</div>
                                    <div class="cost-detail-explanation" id="film-labor-cost-explanation">($30 × 8 × 22 × 1) ÷ 5000 = $1.0560</div>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <canvas id="filmCostChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 毛利分析 -->
                    <div class="gross-profit-analysis">
                        <div class="gross-profit-section">
                            <h3><i class="fas fa-pallet"></i> 吨袋毛利分析</h3>
                            
                            <div class="gross-profit-item">
                                <div class="gross-profit-label">整集装箱毛利</div>
                                <div class="gross-profit-value" id="bag-container-profit">$21,581.48</div>
                                <div class="gross-profit-explanation" id="bag-container-profit-explanation">单袋利润 $2.70 × 8000袋 = $21,581.48</div>
                            </div>
                            
                            <div class="gross-profit-item">
                                <div class="gross-profit-label">整卡板毛利</div>
                                <div class="gross-profit-value" id="bag-pallet-profit">$539.54</div>
                                <div class="gross-profit-explanation" id="bag-pallet-profit-explanation">单袋利润 $2.70 × 200袋 = $539.54</div>
                            </div>
                        </div>
                        
                        <div class="gross-profit-section">
                            <h3><i class="fas fa-film"></i> 缠绕膜毛利分析</h3>
                            
                            <div class="gross-profit-item">
                                <div class="gross-profit-label">整集装箱毛利</div>
                                <div class="gross-profit-value" id="film-container-profit">$10,321.53</div>
                                <div class="gross-profit-explanation" id="film-container-profit-explanation">单卷利润 $3.23 × 3200卷 = $10,321.53</div>
                            </div>
                            
                            <div class="gross-profit-item">
                                <div class="gross-profit-label">整卡板毛利</div>
                                <div class="gross-profit-value" id="film-pallet-profit">$309.65</div>
                                <div class="gross-profit-explanation" id="film-pallet-profit-explanation">单卷利润 $3.23 × 96卷 = $309.65</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 盈亏平衡分析 -->
                    <div class="break-even-analysis">
                        <h3><i class="fas fa-balance-scale"></i> 盈亏平衡分析</h3>
                        
                        <div class="break-even-grid">
                            <div class="break-even-item">
                                <div class="break-even-label">吨袋盈亏平衡点</div>
                                <div class="break-even-value" id="bag-break-even">1,320</div>
                                <div class="break-even-label">袋/月</div>
                                <div class="break-even-explanation" id="bag-break-even-explanation">每月需销售1,320袋才能覆盖固定成本</div>
                                <div class="calculation-explanation">
                                    <div class="calculation-formula" id="bag-break-even-formula">固定成本 ÷ (吨袋售价 - 吨袋变动成本) = 1,320袋</div>
                                </div>
                            </div>
                            
                            <div class="break-even-item">
                                <div class="break-even-label">缠绕膜盈亏平衡点</div>
                                <div class="break-even-value" id="film-break-even">825</div>
                                <div class="break-even-label">卷/月</div>
                                <div class="break-even-explanation" id="film-break-even-explanation">每月需销售825卷才能覆盖固定成本</div>
                                <div class="calculation-explanation">
                                    <div class="calculation-formula" id="film-break-even-formula">固定成本 ÷ (缠绕膜售价 - 缠绕膜变动成本) = 825卷</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="break-even-grid">
                            <div class="break-even-item">
                                <div class="break-even-label">吨袋安全边际</div>
                                <div class="break-even-value profit" id="bag-safety-margin">83.5%</div>
                                <div class="break-even-explanation" id="bag-safety-margin-explanation">当前销量高于盈亏平衡点83.5%</div>
                                <div class="calculation-explanation">
                                    <div class="calculation-formula" id="bag-safety-margin-formula">(当前销量 - 盈亏平衡点) ÷ 当前销量 × 100% = 83.5%</div>
                                </div>
                            </div>
                            
                            <div class="break-even-item">
                                <div class="break-even-label">缠绕膜安全边际</div>
                                <div class="break-even-value profit" id="film-safety-margin">83.5%</div>
                                <div class="break-even-explanation" id="film-safety-margin-explanation">当前销量高于盈亏平衡点83.5%</div>
                                <div class="calculation-explanation">
                                    <div class="calculation-formula" id="film-safety-margin-formula">(当前销量 - 盈亏平衡点) ÷ 当前销量 × 100% = 83.5%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 资金回报率分析 -->
                    <div class="financial-analysis">
                        <h3><i class="fas fa-chart-line"></i> 资金回报率分析</h3>
                        
                        <div class="capital-occupation-inputs">
                            <div class="capital-occupation-input">
                                <label for="bags-in-warehouse">吨袋在仓库数量</label>
                                <input type="number" id="bags-in-warehouse" value="1">
                            </div>
                            <div class="capital-occupation-input">
                                <label for="bags-at-sea">吨袋在海上数量</label>
                                <input type="number" id="bags-at-sea" value="1">
                            </div>
                            <div class="capital-occupation-input">
                                <label for="bags-in-china">吨袋在中国数量</label>
                                <input type="number" id="bags-in-china" value="1">
                            </div>
                            
                            <div class="capital-occupation-input">
                                <label for="film-in-warehouse">缠绕膜在仓库数量</label>
                                <input type="number" id="film-in-warehouse" value="1">
                            </div>
                            <div class="capital-occupation-input">
                                <label for="film-at-sea">缠绕膜在海上数量</label>
                                <input type="number" id="film-at-sea" value="1">
                            </div>
                            <div class="capital-occupation-input">
                                <label for="film-in-china">缠绕膜在中国数量</label>
                                <input type="number" id="film-in-china" value="1">
                            </div>
                        </div>
                        
                        <div class="roi-layout">
                            <!-- 吨袋ROI分析 -->
                            <div class="roi-section">
                                <div class="finance-item">
                                    <div class="finance-label">吨袋总资金占用</div>
                                    <div class="finance-value" id="bag-capital-total">$85,406.40</div>
                                    <div class="calculation-explanation">
                                        <div class="calculation-formula" id="bag-capital-total-formula">总数量: 3集装箱 × 8000袋 × $6.44 = $85,406.40</div>
                                    </div>
                                </div>
                                
                                <div class="finance-item">
                                    <div class="finance-label">吨袋总利润</div>
                                    <div class="finance-value profit" id="bag-total-profit">$21,581.48</div>
                                    <div class="calculation-explanation">
                                        <div class="calculation-formula" id="bag-total-profit-formula">总数量: 3集装箱 × 8000袋 × $2.70 = $21,581.48</div>
                                    </div>
                                </div>
                                
                                <div class="finance-item">
                                    <div class="finance-label">吨袋单周期ROI</div>
                                    <div class="finance-value" id="bag-roi">25.27%</div>
                                    <div class="calculation-explanation">
                                        <div class="calculation-formula" id="bag-roi-formula">(总利润 $21,581.48 / 总资金占用 $85,406.40) × 100% = 25.27%</div>
                                    </div>
                                </div>
                                
                                <div class="finance-item">
                                    <div class="finance-label">吨袋年化ROI</div>
                                    <div class="finance-value" id="bag-annualized-roi">75.81%</div>
                                    <div class="calculation-explanation">
                                        <div class="calculation-formula" id="bag-annualized-roi-formula">单周期ROI 25.27% × (12 / 4个月) = 75.81%</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 缠绕膜ROI分析 -->
                            <div class="roi-section">
                                <div class="finance-item">
                                    <div class="finance-label">缠绕膜总资金占用</div>
                                    <div class="finance-value" id="film-capital-total">$42,768.00</div>
                                    <div class="calculation-explanation">
                                        <div class="calculation-formula" id="film-capital-total-formula">总数量: 3集装箱 × 3200卷 × $9.77 = $42,768.00</div>
                                    </div>
                                </div>
                                
                                <div class="finance-item">
                                    <div class="finance-label">缠绕膜总利润</div>
                                    <div class="finance-value profit" id="film-total-profit">$10,321.53</div>
                                    <div class="calculation-explanation">
                                        <div class="calculation-formula" id="film-total-profit-formula">总数量: 3集装箱 × 3200卷 × $3.23 = $10,321.53</div>
                                    </div>
                                </div>
                                
                                <div class="finance-item">
                                    <div class="finance-label">缠绕膜单周期ROI</div>
                                    <div class="finance-value" id="film-roi">24.13%</div>
                                    <div class="calculation-explanation">
                                        <div class="calculation-formula" id="film-roi-formula">(总利润 $10,321.53 / 总资金占用 $42,768.00) × 100% = 24.13%</div>
                                    </div>
                                </div>
                                
                                <div class="finance-item">
                                    <div class="finance-label">缠绕膜年化ROI</div>
                                    <div class="finance-value" id="film-annualized-roi">72.39%</div>
                                    <div class="calculation-explanation">
                                        <div class="calculation-formula" id="film-annualized-roi-formula">单周期ROI 24.13% × (12 / 4个月) = 72.39%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="finance-grid">
                            <div class="finance-item">
                                <div class="finance-label">整体资金占用</div>
                                <div class="finance-value" id="total-capital">$128,174.40</div>
                                <div class="calculation-explanation">
                                    <div class="calculation-formula" id="total-capital-formula">$85,406.40 + $42,768.00 = $128,174.40</div>
                                </div>
                            </div>
                            
                            <div class="finance-item">
                                <div class="finance-label">整体总利润</div>
                                <div class="finance-value profit" id="total-profit">$31,903.01</div>
                                <div class="calculation-explanation">
                                    <div class="calculation-formula" id="total-profit-formula">$21,581.48 + $10,321.53 = $31,903.01</div>
                                </div>
                            </div>
                            
                            <div class="finance-item">
                                <div class="finance-label">整体单周期ROI</div>
                                <div class="finance-value" id="total-roi">24.89%</div>
                                <div class="calculation-explanation">
                                    <div class="calculation-formula" id="total-roi-formula">(总利润 $31,903.01 / 总资金占用 $128,174.40) × 100% = 24.89%</div>
                                </div>
                            </div>
                            
                            <div class="finance-item">
                                <div class="finance-label">整体年化ROI</div>
                                <div class="finance-value" id="total-annualized-roi">74.67%</div>
                                <div class="calculation-explanation">
                                    <div class="calculation-formula" id="total-annualized-roi-formula">单周期ROI 24.89% × (12 / 4个月) = 74.67%</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="finance-chart-container">
                            <canvas id="roiComparisonChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- 敏感性分析 -->
                    <div class="sensitivity-analysis">
                        <h3><i class="fas fa-chart-line"></i> 毛利率敏感性分析</h3>
                        
                        <div class="sensitivity-grid">
                            <div class="param-item">
                                <label for="sensitivity-var">分析变量</label>
                                <select id="sensitivity-var">
                                    <option value="exchange-rate">人民币汇率</option>
                                    <option value="shipping-cost">海运费</option>
                                    <option value="bag-sale-price">吨袋销售价</option>
                                    <option value="film-sale-price">缠绕膜销售价</option>
                                </select>
                            </div>
                            
                            <div class="param-item">
                                <label for="sensitivity-range">变化范围</label>
                                <select id="sensitivity-range">
                                    <option value="10">±10%</option>
                                    <option value="20">±20%</option>
                                    <option value="30">±30%</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="sensitivity-chart-container">
                            <canvas id="sensitivityChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>© 2025 吨袋缠绕膜销售分析系统 | 专业财务分析版</p>
        </footer>
    </div>

    <script>
        // 图表实例
        let bagCostChart = null;
        let filmCostChart = null;
        let sensitivityChart = null;
        let roiComparisonChart = null;
        let currentBagType = "2";
        let currentFilmType = "70ga";
        
        // 计算函数
        function calculate() {
            try {
                // 获取用户输入
                const exchangeRate = parseFloat(document.getElementById('exchange-rate').value) || 0.186;
                const usdToCad = parseFloat(document.getElementById('usd-to-cad').value) || 1.35;
                const shippingCost = parseFloat(document.getElementById('shipping-cost').value) || 5000;
                const palletStorage = parseFloat(document.getElementById('pallet-storage').value) || 16;
                const palletHandling = parseFloat(document.getElementById('pallet-handling').value) || 25;
                const storageTime = parseFloat(document.getElementById('storage-time').value) || 3;
                const interestRate = parseFloat(document.getElementById('interest-rate').value) / 100 || 0.05;
                const capitalTime = parseFloat(document.getElementById('capital-time').value) / 12 || 0.333; // 4个月
                
                // 低申报系数
                const bagUnderDeclaration = parseFloat(document.getElementById('bag-under-declaration').value) || 1.0;
                const filmUnderDeclaration = parseFloat(document.getElementById('film-under-declaration').value) || 1.0;
                
                // 吨袋参数
                const tariffBagRate = parseFloat(document.getElementById('tariff-bag').value) / 100 || 0.18;
                const factoryPrice = parseFloat(document.getElementById('factory-price').value) || 2.636;
                const containerSize = parseFloat(document.getElementById('container-size').value) || 8000;
                const bagsPerPallet = parseFloat(document.getElementById('bags-per-pallet').value) || 200;
                
                // 缠绕膜参数
                const tariffFilmRate = parseFloat(document.getElementById('tariff-film').value) / 100 || 0.15;
                const filmUsagePerBag = parseFloat(document.getElementById('film-usage').value) || 30;
                const filmLength = parseFloat(document.getElementById('film-length').value) || 450;
                const filmFactoryPrice = parseFloat(document.getElementById('film-factory-price').value) || 3.3;
                const rollsPerContainer = parseFloat(document.getElementById('rolls-per-container').value) || 3200;
                const rollsPerPallet = parseFloat(document.getElementById('rolls-per-pallet').value) || 96;
                
                // 人工参数
                const laborRate = parseFloat(document.getElementById('labor-rate').value) || 30;
                const laborCount = parseFloat(document.getElementById('labor-count').value) || 1;
                const dailyHours = parseFloat(document.getElementById('daily-hours').value) || 8;
                const workDays = parseFloat(document.getElementById('work-days').value) || 22;
                const monthlyBags = parseFloat(document.getElementById('monthly-bags').value) || 8000;
                const monthlyRolls = parseFloat(document.getElementById('monthly-rolls').value) || 5000;
                
                // 从选中的吨袋规格获取销售价
                const bagSalePrice = parseFloat(document.querySelector(`.bag-type.selected .bag-price-input`).value) || 9.14;
                // 从选中的缠绕膜规格获取销售价
                const filmRetailPrice = parseFloat(document.querySelector(`.film-type.selected .film-price-input`).value) || 13.00;
                
                // 计算吨袋采购成本
                const bagPurchaseCost = factoryPrice * usdToCad;
                
                // 计算吨袋海运费（乘以低申报系数）
                const bagShippingPerBag = (shippingCost * usdToCad) / containerSize;
                const declaredBagValue = bagPurchaseCost * bagUnderDeclaration;
                const bagTariffCost = (declaredBagValue + bagShippingPerBag) * tariffBagRate;

                const bagStorageCost = (palletHandling + palletStorage * storageTime) * usdToCad / bagsPerPallet;
                const bagLaborCost = (laborRate * dailyHours * workDays * laborCount) / monthlyBags;
                
                // 获取开关状态
                const toggleBagPurchase = document.getElementById('toggle-bag-purchase').checked ? 1 : 0;
                const toggleBagShipping = document.getElementById('toggle-bag-shipping').checked ? 1 : 0;
                const toggleBagTariff = document.getElementById('toggle-bag-tariff').checked ? 1 : 0;
                const toggleBagStorage = document.getElementById('toggle-bag-storage').checked ? 1 : 0;
                const toggleBagCapital = document.getElementById('toggle-bag-capital').checked ? 1 : 0;
                const toggleBagLabor = document.getElementById('toggle-bag-labor').checked ? 1 : 0;
                
                // 计算基础成本（仅包含开启的成本项）
                let bagBaseCost = 0;
                bagBaseCost += bagPurchaseCost * toggleBagPurchase;
                bagBaseCost += bagShippingPerBag * toggleBagShipping;
                bagBaseCost += bagTariffCost * toggleBagTariff;
                bagBaseCost += bagStorageCost * toggleBagStorage;
                
                // 计算资金成本（基于开启的基础成本）
                const bagCapitalCost = bagBaseCost * interestRate * capitalTime;
                
                // 计算吨袋总成本（包含所有开启的成本项）
                const bagTotalCost = bagBaseCost + 
                                    (bagCapitalCost * toggleBagCapital) + 
                                    (bagLaborCost * toggleBagLabor);
                
                // 计算吨袋利润（按袋）
                const bagProfitPerBag = bagSalePrice - bagTotalCost;
                const bagGrossMargin = (bagProfitPerBag / bagSalePrice * 100).toFixed(1);
                
                // 计算缠绕膜采购成本
                const filmPurchaseCostPerRoll = filmFactoryPrice * usdToCad;
                
                // 计算缠绕膜海运费（乘以低申报系数）
                const filmShippingPerRoll = (shippingCost * usdToCad) / rollsPerContainer;
                const declaredFilmValue = filmPurchaseCostPerRoll * filmUnderDeclaration;
                const filmTariffCostPerRoll = (declaredFilmValue + filmShippingPerRoll) * tariffFilmRate;
                const filmStorageCostPerRoll = (palletHandling + palletStorage * storageTime) * usdToCad / rollsPerPallet;
                const filmLaborCost = (laborRate * dailyHours * workDays * laborCount) / monthlyRolls;
                
                // 获取开关状态
                const toggleFilmPurchase = document.getElementById('toggle-film-purchase').checked ? 1 : 0;
                const toggleFilmShipping = document.getElementById('toggle-film-shipping').checked ? 1 : 0;
                const toggleFilmTariff = document.getElementById('toggle-film-tariff').checked ? 1 : 0;
                const toggleFilmStorage = document.getElementById('toggle-film-storage').checked ? 1 : 0;
                const toggleFilmCapital = document.getElementById('toggle-film-capital').checked ? 1 : 0;
                const toggleFilmLabor = document.getElementById('toggle-film-labor').checked ? 1 : 0;
                
                // 计算基础成本（仅包含开启的成本项）
                let filmBaseCost = 0;
                filmBaseCost += filmPurchaseCostPerRoll * toggleFilmPurchase;
                filmBaseCost += filmShippingPerRoll * toggleFilmShipping;
                filmBaseCost += filmTariffCostPerRoll * toggleFilmTariff;
                filmBaseCost += filmStorageCostPerRoll * toggleFilmStorage;
                
                // 计算资金成本（基于开启的基础成本）
                const filmCapitalCostPerRoll = filmBaseCost * interestRate * capitalTime;
                
                // 计算缠绕膜总成本（包含所有开启的成本项）
                const filmTotalCostPerRoll = filmBaseCost + 
                                            (filmCapitalCostPerRoll * toggleFilmCapital) + 
                                            (filmLaborCost * toggleFilmLabor);
                
                // 计算缠绕膜利润（按卷）
                const filmProfitPerRoll = filmRetailPrice - filmTotalCostPerRoll;
                const filmGrossMargin = (filmProfitPerRoll / filmRetailPrice * 100).toFixed(1);
                
                // 更新吨袋结果
                document.getElementById('bag-total-cost').textContent = `$${bagTotalCost.toFixed(2)}`;
                document.getElementById('bag-sale-price').textContent = `$${bagSalePrice.toFixed(2)}`;
                document.getElementById('bag-profit-per').textContent = `$${bagProfitPerBag.toFixed(2)}`;
                document.getElementById('bag-gross-margin').textContent = `${bagGrossMargin}%`;
                
                // 更新吨袋成本
                document.getElementById('bag-purchase-cost').textContent = `$${(bagPurchaseCost * toggleBagPurchase).toFixed(2)}`;
                document.getElementById('bag-shipping-cost').textContent = `$${(bagShippingPerBag * toggleBagShipping).toFixed(2)}`;
                document.getElementById('bag-tariff-cost').textContent = `$${(bagTariffCost * toggleBagTariff).toFixed(2)}`;
                document.getElementById('bag-storage-cost').textContent = `$${(bagStorageCost * toggleBagStorage).toFixed(2)}`;
                document.getElementById('bag-capital-cost').textContent = `$${(bagCapitalCost * toggleBagCapital).toFixed(2)}`;
                document.getElementById('bag-labor-cost').textContent = `$${(bagLaborCost * toggleBagLabor).toFixed(2)}`;
                
                // 更新公式说明
                document.getElementById('bag-purchase-cost-explanation').textContent = 
                    `工厂价格: $${factoryPrice} × ${usdToCad} = $${bagPurchaseCost.toFixed(2)}`;
                
                document.getElementById('bag-shipping-cost-explanation').textContent =
                    `$${shippingCost} × ${usdToCad} ÷ ${containerSize} = $${bagShippingPerBag.toFixed(4)}`;
                
                document.getElementById('bag-tariff-cost-explanation').textContent = 
                    `(${bagPurchaseCost.toFixed(2)} × ${bagUnderDeclaration} + ${bagShippingPerBag.toFixed(2)}) × ${(tariffBagRate*100).toFixed(1)}% = $${bagTariffCost.toFixed(4)}`;
                
                document.getElementById('bag-storage-cost-explanation').textContent = 
                    `($${palletHandling} + $${palletStorage} × ${storageTime}) × ${usdToCad} ÷ ${bagsPerPallet} = $${bagStorageCost.toFixed(4)}`;
                
                document.getElementById('bag-capital-cost-explanation').textContent = 
                    `(${bagBaseCost.toFixed(2)}) × ${(interestRate*100).toFixed(1)}% × ${(capitalTime*12).toFixed(0)}/12 = $${bagCapitalCost.toFixed(4)}`;
                
                document.getElementById('bag-labor-cost-explanation').textContent = 
                    `($${laborRate} × ${dailyHours} × ${workDays} × ${laborCount}) ÷ ${monthlyBags} = $${bagLaborCost.toFixed(4)}`;
                
                // 更新缠绕膜结果
                document.getElementById('film-total-cost').textContent = `$${filmTotalCostPerRoll.toFixed(2)}`;
                document.getElementById('film-sale-price').textContent = `$${filmRetailPrice.toFixed(2)}`;
                document.getElementById('film-profit-per').textContent = `$${filmProfitPerRoll.toFixed(2)}`;
                document.getElementById('film-gross-margin').textContent = `${filmGrossMargin}%`;
                
                // 更新公式说明
                document.getElementById('film-purchase-cost-explanation').textContent = 
                    `工厂价格: $${filmFactoryPrice} × ${usdToCad} = $${filmPurchaseCostPerRoll.toFixed(4)}`;
                
                document.getElementById('film-shipping-cost-explanation').textContent = 
                    `$${shippingCost} × ${usdToCad} ÷ ${rollsPerContainer} = $${filmShippingPerRoll.toFixed(4)}`;
                
                document.getElementById('film-tariff-cost-explanation').textContent = 
                    tariffFilmRate > 0 
                        ? `(${filmPurchaseCostPerRoll.toFixed(2)} × ${filmUnderDeclaration} + ${filmShippingPerRoll.toFixed(2)}) × ${(tariffFilmRate*100).toFixed(1)}% = $${filmTariffCostPerRoll.toFixed(4)}`
                        : "关税税率为0%，无需缴纳";
                
                document.getElementById('film-storage-cost-explanation').textContent = 
                    `($${palletHandling} + $${palletStorage} × ${storageTime}) × ${usdToCad} ÷ ${rollsPerPallet} = $${filmStorageCostPerRoll.toFixed(4)}`;
                
                document.getElementById('film-capital-cost-explanation').textContent = 
                    `(${filmBaseCost.toFixed(2)}) × ${(interestRate*100).toFixed(1)}% × ${(capitalTime*12).toFixed(0)}/12 = $${filmCapitalCostPerRoll.toFixed(4)}`;
                
                document.getElementById('film-labor-cost-explanation').textContent = 
                    `($${laborRate} × ${dailyHours} × ${workDays} × ${laborCount}) ÷ ${monthlyRolls} = $${filmLaborCost.toFixed(4)}`;
                
                // 更新成本结构图表
                updateBagCostChart(
                    bagPurchaseCost * toggleBagPurchase,
                    bagShippingPerBag * toggleBagShipping,
                    bagTariffCost * toggleBagTariff,
                    bagStorageCost * toggleBagStorage,
                    bagCapitalCost * toggleBagCapital,
                    bagLaborCost * toggleBagLabor
                );
                
                updateFilmCostChart(
                    filmPurchaseCostPerRoll * toggleFilmPurchase,
                    filmShippingPerRoll * toggleFilmShipping,
                    filmTariffCostPerRoll * toggleFilmTariff,
                    filmStorageCostPerRoll * toggleFilmStorage,
                    filmCapitalCostPerRoll * toggleFilmCapital,
                    filmLaborCost * toggleFilmLabor
                );
                
                // 更新开关UI状态
                updateToggleUI();
                
                // 更新毛利分析
                updateGrossProfitAnalysis(
                    bagProfitPerBag, 
                    filmProfitPerRoll, 
                    containerSize, 
                    bagsPerPallet, 
                    rollsPerContainer, 
                    rollsPerPallet
                );
                
                // 计算并更新资金回报率
                calculateROI(
                    bagTotalCost,
                    filmTotalCostPerRoll,
                    bagProfitPerBag,
                    filmProfitPerRoll,
                    containerSize,
                    rollsPerContainer,
                    capitalTime,
                    bagSalePrice,
                    filmRetailPrice
                );
                
                // 更新盈亏平衡点
                calculateBreakEven(
                    bagProfitPerBag,
                    filmProfitPerRoll,
                    bagLaborCost,
                    filmLaborCost,
                    laborRate,
                    dailyHours,
                    workDays,
                    laborCount,
                    monthlyBags,
                    monthlyRolls,
                    bagSalePrice,
                    filmRetailPrice
                );
                
                // 更新敏感性分析
                updateSensitivityAnalysis(
                    exchangeRate,
                    shippingCost,
                    bagSalePrice,
                    filmRetailPrice,
                    bagTotalCost,
                    filmTotalCostPerRoll,
                    bagShippingPerBag,
                    filmShippingPerRoll,
                    usdToCad,
                    containerSize,
                    rollsPerContainer
                );
            } catch (error) {
                console.error('计算错误:', error);
                alert('计算过程中发生错误，请检查输入值: ' + error.message);
            }
        }
        
        // 更新毛利分析
        function updateGrossProfitAnalysis(
            bagProfitPerBag, 
            filmProfitPerRoll, 
            containerSize, 
            bagsPerPallet, 
            rollsPerContainer, 
            rollsPerPallet
        ) {
            // 计算整集装箱毛利
            const bagContainerProfit = bagProfitPerBag * containerSize;
            const filmContainerProfit = filmProfitPerRoll * rollsPerContainer;
            
            // 计算整卡板毛利
            const bagPalletProfit = bagProfitPerBag * bagsPerPallet;
            const filmPalletProfit = filmProfitPerRoll * rollsPerPallet;
            
            // 更新吨袋毛利分析
            document.getElementById('bag-container-profit').textContent = `$${bagContainerProfit.toFixed(2)}`;
            document.getElementById('bag-container-profit-explanation').textContent = 
                `单袋利润 $${bagProfitPerBag.toFixed(2)} × ${containerSize}袋 = $${bagContainerProfit.toFixed(2)}`;
                
            document.getElementById('bag-pallet-profit').textContent = `$${bagPalletProfit.toFixed(2)}`;
            document.getElementById('bag-pallet-profit-explanation').textContent = 
                `单袋利润 $${bagProfitPerBag.toFixed(2)} × ${bagsPerPallet}袋 = $${bagPalletProfit.toFixed(2)}`;
                
            // 更新缠绕膜毛利分析
            document.getElementById('film-container-profit').textContent = `$${filmContainerProfit.toFixed(2)}`;
            document.getElementById('film-container-profit-explanation').textContent = 
                `单卷利润 $${filmProfitPerRoll.toFixed(2)} × ${rollsPerContainer}卷 = $${filmContainerProfit.toFixed(2)}`;
                
            document.getElementById('film-pallet-profit').textContent = `$${filmPalletProfit.toFixed(2)}`;
            document.getElementById('film-pallet-profit-explanation').textContent = 
                `单卷利润 $${filmProfitPerRoll.toFixed(2)} × ${rollsPerPallet}卷 = $${filmPalletProfit.toFixed(2)}`;
        }
        
        // 计算并更新资金回报率 - 专业版
        function calculateROI(
            bagTotalCostPerBag,
            filmTotalCostPerRoll,
            bagProfitPerBag,
            filmProfitPerRoll,
            containerSize,
            rollsPerContainer,
            capitalTime,
            bagSalePrice,
            filmRetailPrice
        ) {
            // 获取资金占用输入
            const bagsInWarehouse = parseInt(document.getElementById('bags-in-warehouse').value) || 1;
            const bagsAtSea = parseInt(document.getElementById('bags-at-sea').value) || 1;
            const bagsInChina = parseInt(document.getElementById('bags-in-china').value) || 1;
            const filmInWarehouse = parseInt(document.getElementById('film-in-warehouse').value) || 1;
            const filmAtSea = parseInt(document.getElementById('film-at-sea').value) || 1;
            const filmInChina = parseInt(document.getElementById('film-in-china').value) || 1;
            
            // 计算吨袋总数量和缠绕膜总数量
            const totalBags = (bagsInWarehouse + bagsAtSea + bagsInChina) * containerSize;
            const totalRolls = (filmInWarehouse + filmAtSea + filmInChina) * rollsPerContainer;
            
            // 计算总资金占用（包括所有成本）
            const bagCapitalTotal = totalBags * bagTotalCostPerBag;
            const filmCapitalTotal = totalRolls * filmTotalCostPerRoll;
            const totalCapital = bagCapitalTotal + filmCapitalTotal;
            
            // 计算总利润
            const bagTotalProfit = totalBags * bagProfitPerBag;
            const filmTotalProfit = totalRolls * filmProfitPerRoll;
            const totalProfit = bagTotalProfit + filmTotalProfit;
            
            // 计算单周期ROI
            const bagROI = bagCapitalTotal > 0 ? (bagTotalProfit / bagCapitalTotal) * 100 : 0;
            const filmROI = filmCapitalTotal > 0 ? (filmTotalProfit / filmCapitalTotal) * 100 : 0;
            const totalROI = totalCapital > 0 ? (totalProfit / totalCapital) * 100 : 0;
            
            // 计算年化ROI
            const bagAnnualizedROI = bagROI * (12 / (capitalTime * 12));
            const filmAnnualizedROI = filmROI * (12 / (capitalTime * 12));
            const totalAnnualizedROI = totalROI * (12 / (capitalTime * 12));
            
            // 更新资金占用显示
            document.getElementById('bag-capital-total').textContent = `$${bagCapitalTotal.toFixed(2)}`;
            document.getElementById('bag-capital-total-formula').textContent = 
                `总数量: ${(bagsInWarehouse + bagsAtSea + bagsInChina)}集装箱 × ${containerSize}袋 × $${bagTotalCostPerBag.toFixed(2)} = $${bagCapitalTotal.toFixed(2)}`;
                
            document.getElementById('film-capital-total').textContent = `$${filmCapitalTotal.toFixed(2)}`;
            document.getElementById('film-capital-total-formula').textContent = 
                `总数量: ${(filmInWarehouse + filmAtSea + filmInChina)}集装箱 × ${rollsPerContainer}卷 × $${filmTotalCostPerRoll.toFixed(2)} = $${filmCapitalTotal.toFixed(2)}`;
                
            document.getElementById('total-capital').textContent = `$${totalCapital.toFixed(2)}`;
            document.getElementById('total-capital-formula').textContent = 
                `$${bagCapitalTotal.toFixed(2)} + $${filmCapitalTotal.toFixed(2)} = $${totalCapital.toFixed(2)}`;
            
            // 更新利润显示
            document.getElementById('bag-total-profit').textContent = `$${bagTotalProfit.toFixed(2)}`;
            document.getElementById('bag-total-profit-formula').textContent = 
                `总数量: ${(bagsInWarehouse + bagsAtSea + bagsInChina)}集装箱 × ${containerSize}袋 × $${bagProfitPerBag.toFixed(2)} = $${bagTotalProfit.toFixed(2)}`;
                
            document.getElementById('film-total-profit').textContent = `$${filmTotalProfit.toFixed(2)}`;
            document.getElementById('film-total-profit-formula').textContent = 
                `总数量: ${(filmInWarehouse + filmAtSea + filmInChina)}集装箱 × ${rollsPerContainer}卷 × $${filmProfitPerRoll.toFixed(2)} = $${filmTotalProfit.toFixed(2)}`;
                
            document.getElementById('total-profit').textContent = `$${totalProfit.toFixed(2)}`;
            document.getElementById('total-profit-formula').textContent = 
                `$${bagTotalProfit.toFixed(2)} + $${filmTotalProfit.toFixed(2)} = $${totalProfit.toFixed(2)}`;
            
            // 更新ROI显示
            document.getElementById('bag-roi').textContent = `${bagROI.toFixed(2)}%`;
            document.getElementById('bag-roi-formula').textContent = 
                `(总利润 $${bagTotalProfit.toFixed(2)} / 总资金占用 $${bagCapitalTotal.toFixed(2)}) × 100% = ${bagROI.toFixed(2)}%`;
                
            document.getElementById('film-roi').textContent = `${filmROI.toFixed(2)}%`;
            document.getElementById('film-roi-formula').textContent = 
                `(总利润 $${filmTotalProfit.toFixed(2)} / 总资金占用 $${filmCapitalTotal.toFixed(2)}) × 100% = ${filmROI.toFixed(2)}%`;
                
            document.getElementById('total-roi').textContent = `${totalROI.toFixed(2)}%`;
            document.getElementById('total-roi-formula').textContent = 
                `(总利润 $${totalProfit.toFixed(2)} / 总资金占用 $${totalCapital.toFixed(2)}) × 100% = ${totalROI.toFixed(2)}%`;
            
            // 更新年化ROI显示
            document.getElementById('bag-annualized-roi').textContent = `${bagAnnualizedROI.toFixed(2)}%`;
            document.getElementById('bag-annualized-roi-formula').textContent = 
                `单周期ROI ${bagROI.toFixed(2)}% × (12 / ${(capitalTime*12).toFixed(0)}个月) = ${bagAnnualizedROI.toFixed(2)}%`;
                
            document.getElementById('film-annualized-roi').textContent = `${filmAnnualizedROI.toFixed(2)}%`;
            document.getElementById('film-annualized-roi-formula').textContent = 
                `单周期ROI ${filmROI.toFixed(2)}% × (12 / ${(capitalTime*12).toFixed(0)}个月) = ${filmAnnualizedROI.toFixed(2)}%`;
                
            document.getElementById('total-annualized-roi').textContent = `${totalAnnualizedROI.toFixed(2)}%`;
            document.getElementById('total-annualized-roi-formula').textContent = 
                `单周期ROI ${totalROI.toFixed(2)}% × (12 / ${(capitalTime*12).toFixed(0)}个月) = ${totalAnnualizedROI.toFixed(2)}%`;
            
            // 更新ROI比较图表
            updateROIComparisonChart(bagROI, filmROI, totalROI, bagAnnualizedROI, filmAnnualizedROI, totalAnnualizedROI);
        }
        
        // 更新ROI比较图表
        function updateROIComparisonChart(bagROI, filmROI, totalROI, bagAnnualized, filmAnnualized, totalAnnualized) {
            const canvas = document.getElementById('roiComparisonChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // 销毁现有图表实例
            if (roiComparisonChart) {
                roiComparisonChart.destroy();
            }
            
            roiComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['吨袋', '缠绕膜', '整体'],
                    datasets: [
                        {
                            label: '单周期ROI',
                            data: [bagROI, filmROI, totalROI],
                            backgroundColor: '#3498db',
                            borderColor: '#2980b9',
                            borderWidth: 1
                        },
                        {
                            label: '年化ROI',
                            data: [bagAnnualized, filmAnnualized, totalAnnualized],
                            backgroundColor: '#2ecc71',
                            borderColor: '#27ae60',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '资金回报率比较',
                            font: {
                                size: 14
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw.toFixed(2)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: '百分比 (%)'
                            }
                        }
                    }
                }
            });
        }
        
        // 计算盈亏平衡点
        function calculateBreakEven(
            bagProfitPerBag,
            filmProfitPerRoll,
            bagLaborCost,
            filmLaborCost,
            laborRate,
            dailyHours,
            workDays,
            laborCount,
            monthlyBags,
            monthlyRolls,
            bagSalePrice,
            filmRetailPrice
        ) {
            // 计算固定成本（人工成本总额）
            const fixedCost = laborRate * dailyHours * workDays * laborCount;
            
            // 计算吨袋的变动成本（总成本减去人工成本）
            const bagVariableCostPerBag = (bagSalePrice - bagProfitPerBag) - bagLaborCost;
            
            // 计算缠绕膜的变动成本（总成本减去人工成本）
            const filmVariableCostPerRoll = (filmRetailPrice - filmProfitPerRoll) - filmLaborCost;
            
            // 计算吨袋的贡献毛益（每袋利润 + 每袋人工成本）
            const bagContributionMargin = bagSalePrice - bagVariableCostPerBag;
            
            // 计算缠绕膜的贡献毛益（每卷利润 + 每卷人工成本）
            const filmContributionMargin = filmRetailPrice - filmVariableCostPerRoll;
            
            // 计算盈亏平衡点
            const bagBreakEven = bagContributionMargin > 0 ? Math.ceil(fixedCost / bagContributionMargin) : 0;
            const filmBreakEven = filmContributionMargin > 0 ? Math.ceil(fixedCost / filmContributionMargin) : 0;
            
            // 计算安全边际
            const bagSafetyMargin = monthlyBags > 0 ? ((monthlyBags - bagBreakEven) / monthlyBags * 100).toFixed(1) : 0;
            const filmSafetyMargin = monthlyRolls > 0 ? ((monthlyRolls - filmBreakEven) / monthlyRolls * 100).toFixed(1) : 0;
            
            // 更新显示
            document.getElementById('bag-break-even').textContent = bagBreakEven.toLocaleString();
            document.getElementById('bag-break-even-explanation').textContent = 
                `每月需销售${bagBreakEven.toLocaleString()}袋才能覆盖固定成本`;
            document.getElementById('bag-break-even-formula').textContent = 
                `固定成本 $${fixedCost.toFixed(2)} ÷ (吨袋售价 $${bagSalePrice.toFixed(2)} - 吨袋变动成本 $${bagVariableCostPerBag.toFixed(2)}) = ${bagBreakEven.toLocaleString()}袋`;
                
            document.getElementById('film-break-even').textContent = filmBreakEven.toLocaleString();
            document.getElementById('film-break-even-explanation').textContent = 
                `每月需销售${filmBreakEven.toLocaleString()}卷才能覆盖固定成本`;
            document.getElementById('film-break-even-formula').textContent = 
                `固定成本 $${fixedCost.toFixed(2)} ÷ (缠绕膜售价 $${filmRetailPrice.toFixed(2)} - 缠绕膜变动成本 $${filmVariableCostPerRoll.toFixed(2)}) = ${filmBreakEven.toLocaleString()}卷`;
                
            document.getElementById('bag-safety-margin').textContent = `${bagSafetyMargin}%`;
            document.getElementById('bag-safety-margin-explanation').textContent = 
                bagSafetyMargin > 0 
                    ? `当前销量高于盈亏平衡点${bagSafetyMargin}%` 
                    : `当前销量低于盈亏平衡点${Math.abs(bagSafetyMargin)}%`;
            document.getElementById('bag-safety-margin-formula').textContent = 
                `(当前销量 ${monthlyBags} - 盈亏平衡点 ${bagBreakEven}) ÷ 当前销量 ${monthlyBags} × 100% = ${bagSafetyMargin}%`;
                
            document.getElementById('film-safety-margin').textContent = `${filmSafetyMargin}%`;
            document.getElementById('film-safety-margin-explanation').textContent = 
                filmSafetyMargin > 0 
                    ? `当前销量高于盈亏平衡点${filmSafetyMargin}%` 
                    : `当前销量低于盈亏平衡点${Math.abs(filmSafetyMargin)}%`;
            document.getElementById('film-safety-margin-formula').textContent = 
                `(当前销量 ${monthlyRolls} - 盈亏平衡点 ${filmBreakEven}) ÷ 当前销量 ${monthlyRolls} × 100% = ${filmSafetyMargin}%`;
        }
        
        // 更新敏感性分析
        function updateSensitivityAnalysis(
            exchangeRate, 
            shippingCost, 
            bagSalePrice, 
            filmRetailPrice, 
            bagTotalCost, 
            filmTotalCostPerRoll, 
            bagShippingPerBag, 
            filmShippingPerRoll, 
            usdToCad, 
            containerSize, 
            rollsPerContainer
        ) {
            const sensitivityVar = document.getElementById('sensitivity-var').value;
            const sensitivityRange = parseInt(document.getElementById('sensitivity-range').value);
            
            // 生成变化百分比序列
            const changes = [];
            for (let i = -sensitivityRange; i <= sensitivityRange; i += 5) {
                changes.push(i);
            }
            
            const bagMargins = [];
            const filmMargins = [];
            const labels = [];
            
            changes.forEach(change => {
                let newBagMargin, newFilmMargin;
                
                switch(sensitivityVar) {
                    case 'exchange-rate':
                        // 汇率变化会影响采购成本、海运费等
                        const newExchangeRate = exchangeRate * (1 + change / 100);
                        // 简化的重新计算逻辑
                        newBagMargin = (bagSalePrice - (bagTotalCost * (1 + change / 100))) / bagSalePrice * 100;
                        newFilmMargin = (filmRetailPrice - (filmTotalCostPerRoll * (1 + change / 100))) / filmRetailPrice * 100;
                        break;
                    case 'shipping-cost':
                        // 海运费变化
                        const newShippingCost = shippingCost * (1 + change / 100);
                        const newBagShipping = (newShippingCost * usdToCad) / containerSize;
                        const newFilmShipping = (newShippingCost * usdToCad) / rollsPerContainer;
                        
                        newBagMargin = (bagSalePrice - (bagTotalCost + (newBagShipping - bagShippingPerBag))) / bagSalePrice * 100;
                        newFilmMargin = (filmRetailPrice - (filmTotalCostPerRoll + (newFilmShipping - filmShippingPerRoll))) / filmRetailPrice * 100;
                        break;
                    case 'bag-sale-price':
                        // 吨袋销售价变化
                        const newBagPrice = bagSalePrice * (1 + change / 100);
                        newBagMargin = (newBagPrice - bagTotalCost) / newBagPrice * 100;
                        newFilmMargin = (filmRetailPrice - filmTotalCostPerRoll) / filmRetailPrice * 100;
                        break;
                    case 'film-sale-price':
                        // 缠绕膜销售价变化
                        const newFilmPrice = filmRetailPrice * (1 + change / 100);
                        newBagMargin = (bagSalePrice - bagTotalCost) / bagSalePrice * 100;
                        newFilmMargin = (newFilmPrice - filmTotalCostPerRoll) / newFilmPrice * 100;
                        break;
                    default:
                        newBagMargin = (bagSalePrice - bagTotalCost) / bagSalePrice * 100;
                        newFilmMargin = (filmRetailPrice - filmTotalCostPerRoll) / filmRetailPrice * 100;
                }
                
                bagMargins.push(newBagMargin);
                filmMargins.push(newFilmMargin);
                labels.push(change + '%');
            });
            
            // 更新敏感性分析图表
            updateSensitivityChart(labels, bagMargins, filmMargins, sensitivityVar);
        }
        
        // 更新敏感性分析图表
        function updateSensitivityChart(labels, bagMargins, filmMargins, sensitivityVar) {
            const canvas = document.getElementById('sensitivityChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // 销毁现有图表实例
            if (sensitivityChart) {
                sensitivityChart.destroy();
            }
            
            // 获取变量名称
            let varName = '';
            switch(sensitivityVar) {
                case 'exchange-rate': varName = '人民币汇率'; break;
                case 'shipping-cost': varName = '海运费'; break;
                case 'bag-sale-price': varName = '吨袋销售价'; break;
                case 'film-sale-price': varName = '缠绕膜销售价'; break;
                default: varName = '变量';
            }
            
            sensitivityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '吨袋毛利率',
                            data: bagMargins,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.3,
                            fill: false
                        },
                        {
                            label: '缠绕膜毛利率',
                            data: filmMargins,
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            tension: 0.3,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `毛利率敏感性分析 (${varName})`,
                            font: {
                                size: 14
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '变化百分比'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '毛利率 (%)'
                            },
                            min: 0,
                            max: 50
                        }
                    }
                }
            });
        }
        
        // 保存配置
        function saveConfig() {
            const config = {
                exchangeRate: document.getElementById('exchange-rate').value,
                usdToCad: document.getElementById('usd-to-cad').value,
                shippingCost: document.getElementById('shipping-cost').value,
                palletStorage: document.getElementById('pallet-storage').value,
                palletHandling: document.getElementById('pallet-handling').value,
                storageTime: document.getElementById('storage-time').value,
                interestRate: document.getElementById('interest-rate').value,
                capitalTime: document.getElementById('capital-time').value,
                laborRate: document.getElementById('labor-rate').value,
                laborCount: document.getElementById('labor-count').value,
                dailyHours: document.getElementById('daily-hours').value,
                workDays: document.getElementById('work-days').value,
                monthlyBags: document.getElementById('monthly-bags').value,
                monthlyRolls: document.getElementById('monthly-rolls').value,
                tariffBag: document.getElementById('tariff-bag').value,
                bagUnderDeclaration: document.getElementById('bag-under-declaration').value,
                factoryPrice: document.getElementById('factory-price').value,
                containerSize: document.getElementById('container-size').value,
                bagsPerPallet: document.getElementById('bags-per-pallet').value,
                tariffFilm: document.getElementById('tariff-film').value,
                filmUnderDeclaration: document.getElementById('film-under-declaration').value,
                filmUsage: document.getElementById('film-usage').value,
                filmLength: document.getElementById('film-length').value,
                filmFactoryPrice: document.getElementById('film-factory-price').value,
                rollsPerContainer: document.getElementById('rolls-per-container').value,
                rollsPerPallet: document.getElementById('rolls-per-pallet').value,
                bagType: currentBagType,
                filmType: currentFilmType,
                bagPrices: {
                    type1: document.getElementById('bag-type1').value,
                    type2: document.getElementById('bag-type2').value,
                    type3: document.getElementById('bag-type3').value
                },
                filmPrices: {
                    type1: document.getElementById('film-type1').value,
                    type2: document.getElementById('film-type2').value,
                    type3: document.getElementById('film-type3').value
                }
            };
            
            localStorage.setItem('bagFilmCostCalcConfig', JSON.stringify(config));
            
            // 显示保存成功通知
            const notification = document.getElementById('saveNotification');
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // 加载配置
        function loadConfig() {
            const config = JSON.parse(localStorage.getItem('bagFilmCostCalcConfig'));
            if (config) {
                document.getElementById('exchange-rate').value = config.exchangeRate;
                document.getElementById('usd-to-cad').value = config.usdToCad;
                document.getElementById('shipping-cost').value = config.shippingCost;
                document.getElementById('pallet-storage').value = config.palletStorage;
                document.getElementById('pallet-handling').value = config.palletHandling;
                document.getElementById('storage-time').value = config.storageTime;
                document.getElementById('interest-rate').value = config.interestRate;
                document.getElementById('capital-time').value = config.capitalTime;
                document.getElementById('labor-rate').value = config.laborRate;
                document.getElementById('labor-count').value = config.laborCount;
                document.getElementById('daily-hours').value = config.dailyHours;
                document.getElementById('work-days').value = config.workDays;
                document.getElementById('monthly-bags').value = config.monthlyBags;
                document.getElementById('monthly-rolls').value = config.monthlyRolls;
                document.getElementById('tariff-bag').value = config.tariffBag;
                document.getElementById('bag-under-declaration').value = config.bagUnderDeclaration;
                document.getElementById('factory-price').value = config.factoryPrice;
                document.getElementById('container-size').value = config.containerSize;
                document.getElementById('bags-per-pallet').value = config.bagsPerPallet;
                document.getElementById('tariff-film').value = config.tariffFilm;
                document.getElementById('film-under-declaration').value = config.filmUnderDeclaration;
                document.getElementById('film-usage').value = config.filmUsage;
                document.getElementById('film-length').value = config.filmLength;
                document.getElementById('film-factory-price').value = config.filmFactoryPrice;
                document.getElementById('rolls-per-container').value = config.rollsPerContainer;
                document.getElementById('rolls-per-pallet').value = config.rollsPerPallet;
                
                document.getElementById('bag-type1').value = config.bagPrices.type1;
                document.getElementById('bag-type2').value = config.bagPrices.type2;
                document.getElementById('bag-type3').value = config.bagPrices.type3;
                
                document.getElementById('film-type1').value = config.filmPrices.type1;
                document.getElementById('film-type2').value = config.filmPrices.type2;
                document.getElementById('film-type3').value = config.filmPrices.type3;
                
                // 设置选中的吨袋和缠绕膜类型
                selectBagType(config.bagType);
                selectFilmType(config.filmType);
            }
        }
        
        // 重置表单
        function resetForm() {
            document.getElementById('exchange-rate').value = 0.186;
            document.getElementById('usd-to-cad').value = 1.35;
            document.getElementById('shipping-cost').value = 5000;
            document.getElementById('pallet-storage').value = 16;
            document.getElementById('pallet-handling').value = 25;
            document.getElementById('storage-time').value = 3;
            document.getElementById('interest-rate').value = 5;
            document.getElementById('capital-time').value = 4;
            document.getElementById('labor-rate').value = 30;
            document.getElementById('labor-count').value = 1;
            document.getElementById('daily-hours').value = 8;
            document.getElementById('work-days').value = 22;
            document.getElementById('monthly-bags').value = 8000;
            document.getElementById('monthly-rolls').value = 5000;
            document.getElementById('tariff-bag').value = 18;
            document.getElementById('bag-under-declaration').value = 1.0;
            document.getElementById('factory-price').value = 2.636;
            document.getElementById('container-size').value = 8000;
            document.getElementById('bags-per-pallet').value = 200;
            document.getElementById('tariff-film').value = 15;
            document.getElementById('film-under-declaration').value = 1.0;
            document.getElementById('film-usage').value = 30;
            document.getElementById('film-length').value = 450;
            document.getElementById('film-factory-price').value = 3.3;
            document.getElementById('rolls-per-container').value = 3200;
            document.getElementById('rolls-per-pallet').value = 96;
            
            document.getElementById('bag-type1').value = 10.08;
            document.getElementById('bag-type2').value = 9.14;
            document.getElementById('bag-type3').value = 10.34;
            
            document.getElementById('film-type1').value = 13;
            document.getElementById('film-type2').value = 13;
            document.getElementById('film-type3').value = 13;
            
            // 重置选中状态
            selectBagType('2');
            selectFilmType('70ga');
            
            // 重置开关状态
            document.querySelectorAll('.toggle input').forEach(toggle => {
                toggle.checked = true;
            });
            
            // 重新计算
            calculate();
        }
        
        // 选择吨袋类型
        function selectBagType(type) {
            currentBagType = type;
            document.querySelectorAll('.bag-type').forEach(el => {
                el.classList.remove('selected');
                if (el.dataset.type === type) {
                    el.classList.add('selected');
                    document.getElementById('selected-bag-spec').textContent = el.querySelector('.bag-spec').textContent;
                    document.getElementById('selected-bag-price').textContent = el.querySelector('.bag-price-input').value;
                }
            });
            calculate();
        }
        
        // 选择缠绕膜类型
        function selectFilmType(type) {
            currentFilmType = type;
            document.querySelectorAll('.film-type').forEach(el => {
                el.classList.remove('selected');
                if (el.dataset.type === type) {
                    el.classList.add('selected');
                    document.getElementById('selected-film-spec').textContent = el.querySelector('.film-spec').textContent;
                    document.getElementById('selected-film-price').textContent = el.querySelector('.film-price-input').value;
                }
            });
            calculate();
        }
        
        // 更新吨袋成本结构图表
        function updateBagCostChart(purchase, shipping, tariff, storage, capital, labor) {
            const canvas = document.getElementById('bagCostChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // 销毁现有图表实例
            if (bagCostChart) {
                bagCostChart.destroy();
            }
            
            bagCostChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['采购成本', '海运费', '关税', '仓储与操作', '资金成本', '人工成本'],
                    datasets: [{
                        data: [purchase, shipping, tariff, storage, capital, labor],
                        backgroundColor: [
                            '#3498db',
                            '#2ecc71',
                            '#9b59b6',
                            '#f1c40f',
                            '#e67e22',
                            '#e74c3c'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        title: {
                            display: true,
                            text: '吨袋成本结构分析',
                            font: {
                                size: 14
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': $' + context.raw.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 更新缠绕膜成本结构图表
        function updateFilmCostChart(purchase, shipping, tariff, storage, capital, labor) {
            const canvas = document.getElementById('filmCostChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // 销毁现有图表实例
            if (filmCostChart) {
                filmCostChart.destroy();
            }
            
            filmCostChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['采购成本', '海运费', '关税', '仓储与操作', '资金成本', '人工成本'],
                    datasets: [{
                        data: [purchase, shipping, tariff, storage, capital, labor],
                        backgroundColor: [
                            '#3498db',
                            '#2ecc71',
                            '#9b59b6',
                            '#f1c40f',
                            '#e67e22',
                            '#e74c3c'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        title: {
                            display: true,
                            text: '缠绕膜成本结构分析',
                            font: {
                                size: 14
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': $' + context.raw.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 更新开关UI状态
        function updateToggleUI() {
            document.querySelectorAll('.cost-detail-item').forEach(item => {
                const toggle = item.querySelector('input[type="checkbox"]');
                if (!toggle.checked) {
                    item.classList.add('cost-item-disabled');
                } else {
                    item.classList.remove('cost-item-disabled');
                }
            });
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 添加吨袋选择事件监听器
            document.querySelectorAll('.bag-type').forEach(el => {
                el.addEventListener('click', function() {
                    selectBagType(this.dataset.type);
                });
                
                // 添加吨袋价格输入事件监听器
                const input = el.querySelector('.bag-price-input');
                input.addEventListener('input', function() {
                    // 如果当前输入的是选中的吨袋类型，更新销售价
                    if (el.classList.contains('selected')) {
                        document.getElementById('selected-bag-price').textContent = this.value;
                        calculate();
                    }
                });
            });
            
            // 添加缠绕膜选择事件监听器
            document.querySelectorAll('.film-type').forEach(el => {
                el.addEventListener('click', function() {
                    selectFilmType(this.dataset.type);
                });
                
                // 添加缠绕膜价格输入事件监听器
                const input = el.querySelector('.film-price-input');
                input.addEventListener('input', function() {
                    // 如果当前输入的是选中的缠绕膜类型，更新销售价
                    if (el.classList.contains('selected')) {
                        document.getElementById('selected-film-price').textContent = this.value;
                        calculate();
                    }
                });
            });
            
            // 添加开关事件监听器
            document.querySelectorAll('.toggle input').forEach(toggle => {
                toggle.addEventListener('change', calculate);
            });
            
            // 添加输入事件监听器
            const inputs = document.querySelectorAll('input:not(.bag-price-input):not(.film-price-input)');
            inputs.forEach(input => {
                input.addEventListener('input', calculate);
            });
            
            // 添加敏感性分析变量选择监听
            document.getElementById('sensitivity-var').addEventListener('change', calculate);
            document.getElementById('sensitivity-range').addEventListener('change', calculate);
            
            // 加载保存的配置
            loadConfig();
            
            // 初始计算
            calculate();
        });
    </script>
</body>
</html>
